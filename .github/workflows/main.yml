name: App CD

on:
  pull_request:
    branches: ["main"]

  push:
    branches: ["main"]

env:
  SSH_AUTH_SOCK: /tmp/ssh_agent.sock

jobs:
  main:
    runs-on: macos-latest
    steps:    
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup java
        uses: actions/setup-java@v3
        with:
          distribution: 'zulu'
          java-version: "17.x"

      - name: Set up Flutter
        uses: subosito/flutter-action@v2
        with:
          channel: 'stable'
          flutter-version: '3.29.3'

      - name: Get Flutter packages
        run: |
          flutter pub get

      - name: Build APK
        run: flutter build apk --release
        
      - name: Install Firebase CLI
        run: |
          curl -sL https://firebase.tools | bash

      - name: Upload to Firebase App Distribution
        run: |
          firebase appdistribution:distribute build/app/outputs/flutter-apk/app-release.apk \
            --app "${{ secrets.APP_ANDROID_ID }}" \
            --groups "testers" \
            --release-notes "Nova build autom√°tica via GitHub Actions" \
            --token ""${{ secrets.FIREBASE_TOKEN }}""

      # - name: Build appBundle
      #   run: flutter build appbundle

      # - name: Build iOS App
      #   run: |
      #     flutter build ios --profile --no-codesign
      #     cd build/ios/iphoneos
      #     mkdir Payload
      #     cd Payload
      #     ln -s ../Runner.app
      #     cd ..
      #     zip -r app.ipa Payload      


      # - name: Upload Artifacts
      #   uses: actions/upload-artifact@v4
      #   with:
      #     name: Releases
      #     path: |
      #       build/app/outputs/flutter-apk/app-release.apk
      #       build/app/outputs/bundle/release/app-release.aab
      #       build/ios/iphoneos/app.ipa



